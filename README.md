# Сервис ProjectsAutomation

Приложение для распределения студентов по группам в соответствии с удобным для них временем.

## Требования
- Для запуска вам понадобится Python 3.6 или выше.
- Получите токен телеграм-бота (создайте бота через диалог с ботом [@BotFather](https://telegram.me/BotFather))

## Переменные окружения
Определите переменные окружения в файле `.env` в формате: `ПЕРЕМЕННАЯ=значение`:
- `TELEGRAM_TOKEN` — токен телеграм-бота
- `DEBUG` — дебаг-режим. Поставьте `True` для включения, `False` -- для 
выключения отладочного режима. По умолчанию дебаг-режим отключен.
- `SECRET_KEY` — секретный ключ проекта.
- `DATABASE_URL` — URL базы данных

## Схема работы приложения:

В БД загружаются данные учащихся одним из способов:
   1. из файла в формате .json вида:

```json
{
  'Students':[
        {
          'FirstName': 'Иван',
          'LastName': 'Иванов',
          'Level': 'Новички',
          'TelegramID': 123456789
        },
        {
          'FirstName': "Дмитрий",
          'LastName': "Белоусов",
          'Level': "Новички",
          'TelegramID': 987654321
        }
    ]
}
```
Файл с названием `input_data.json` должен лежать в папке `/dpa_app/media`. 
Загрузка json происходит из папки media приложения командой:

```commandline
python manage.py import_from_json
```

2. Вручную через админку `sitename/admin/` заносятся в модель "Ученики" поля:
   - ID в Telegram*
   - Имя*
   - Фамилия
   - Уровень*

Также через админку необходимо внести возможные временные слоты занятий (модель
"Временные слоты"), данные ПМов (модель "ПМы"), выбрать доступные слоты у каждого ПМа.

Учащиеся должны быть зарегистрированы в боте: перейти в него и нажать на кнопку `START`.
После этого учащимся рассылаются сообщения со ссылкой на форму, в которой они
могут выбрать время из доступных временных слотов (наиболее удобные слоты и возможные слоты).
В админке указывается время начала и окончания рассылки (модель "Даты рассылок" -- "Ссылки на формы")

### sort.py
В скрипте происходит автоматическое распределение учащихся по группам с учётом 
доступных слотов ПМов и предпочитаемых и возможных слотов учащихся, а также их 
уровню (в одной группе оказываются учащиеся одного уровня). Формируются группы 
по 2-3 человека. 

Id участиков, которых не удалось распределить сохраняются в список 
`secondary_not_included_students`.
Скрипт запускается командой 
```commandline
python manage.py sort
```

После проведения распределения по группам и не ранее выбранной даты рассылки
(модель "Даты рассылок" -- "Результаты распределения") учащимся рассылаются 
данные распределения:
- время созвона
- имя ПМа
- состав группы

### Дополнительные команды:

- Запуск бота : 
```commandline
python manage.py bot
```

## Цели проекта
Код написан в рамках учебного проекта.
